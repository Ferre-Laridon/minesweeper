<UserControl x:Class="View.Screens.GameScreen"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:View.Screens"
        xmlns:converters="clr-namespace:View.Converters"
        mc:Ignorable="d"
        d:DesignHeight="450" d:DesignWidth="800"
        Background="#e8e8e8">

    <UserControl.Resources>
        <converters:SquareValueToImageConverter x:Key="squareValueToImage"/>
        <converters:SquareStatusToImageConverter x:Key="squareStatusToImage"/>
        <converters:GameStatusConverter x:Key="gameStatus"
                                        True="Visible"
                                        False="Hidden"/>
    </UserControl.Resources>

    <DockPanel>

        <Viewbox
            MaxHeight="1000"
            MaxWidth="1000"
            Margin="30">

            <StackPanel VerticalAlignment="Center">

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Border 
                        Grid.Row="0"
                        Visibility="{Binding Lost.Value, Converter={StaticResource gameStatus}}">
                        <TextBlock TextAlignment="Center" FontSize="20" FontWeight="Bold" Text="YOU DIED"/>
                    </Border>
                    <Border
                        Grid.Row="0"
                        Visibility="{Binding Won.Value, Converter={StaticResource gameStatus}}">
                        <TextBlock TextAlignment="Center" FontSize="20" FontWeight="Bold" Text="YOU WON!"/>
                    </Border>

                    <Button 
                        Grid.Row="1"
                        Margin="10"
                        Content="New Game"
                        Height="30" 
                        FontSize="20"
                        FontWeight="Bold"
                        Command="{Binding SwitchToGameScreen}" 
                        Visibility="{Binding End.Value, Converter={StaticResource gameStatus}}"/>
                </Grid>

                <Grid>
                    <ItemsControl ItemsSource="{Binding Board.Rows}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>

                                <ItemsControl ItemsSource="{Binding Squares}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Horizontal"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>

                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Button Height="32" Width="32" BorderThickness="0" Padding="0">

                                                <!--left and right click-->
                                                <Button.InputBindings>
                                                    <MouseBinding Gesture="RightClick" Command="{Binding Flag}" />
                                                    <MouseBinding Gesture="LeftClick" Command="{Binding Uncover}" />
                                                </Button.InputBindings>

                                                <Button.Style>
                                                    <Style TargetType="{x:Type Button}">
                                                        <!--Render buttons-->
                                                        <Setter Property="Content">
                                                            <Setter.Value>
                                                                <Grid>
                                                                    <!--Render images-->
                                                                    <Image 
                                                                        Width="32" 
                                                                        Height="32" 
                                                                        Source="{Binding Square.Value, Converter={StaticResource squareValueToImage}}" />
                                                                    <Image
                                                                        Width="32"
                                                                        Height="32"
                                                                        Source="{Binding Status.Value, Converter={StaticResource squareStatusToImage}}" />
                                                                </Grid>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Grid>

                <Button 
                    Margin="10"
                    Content="Quit"
                    Height="30" 
                    FontSize="20"
                    FontWeight="Bold"
                    Command="{Binding SwitchToStartScreen}" />

                <TextBlock Text="{Binding Timer.ElapsedTimeCell.Value, StringFormat={}{0:mm}:{0:ss}:{0:ff}, FallbackValue=00:00:00}"
                           FontSize="20"
                           FontWeight="Bold"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>

            </StackPanel>
        </Viewbox>
    </DockPanel>
</UserControl>
